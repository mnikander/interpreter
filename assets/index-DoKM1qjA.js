(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const L={WHITESPACE:/^\s+/,OPEN:/^\(/,CLOSE:/^\)/,BOOLEAN:/^(true|false)/,NUMBER:/^[-+]?(?:\d*\.\d+|\d+\.\d*|\d+)/,STRING:/^"(\\.|[^"\\])*"|'(\\.|[^'\\])*'/,IDENTIFIER:/^(?:([_a-zA-Z][_a-zA-Z0-9]*)|([.,:;!?<>\=\@\#\$\+\-\*\/\%\&\|\^\~]+))/};function O(e){let t={tag:"State",offset:0,line:e,tokens:[]};for(;t.offset<t.line.length;){const n=d(t,"BOOLEAN")??d(t,"NUMBER")??d(t,"STRING")??d(t,"IDENTIFIER")??d(t,"WHITESPACE")??d(t,"OPEN")??d(t,"CLOSE");if(n)n.lexeme==="BOOLEAN"?t=c(t,C(t,n)):n.lexeme==="NUMBER"?t=c(t,S(t,n)):n.lexeme==="STRING"?t=c(t,T(t,n)):n.lexeme==="IDENTIFIER"?t=c(t,F(t,n)):n.lexeme==="OPEN"?t=c(t,R(t)):n.lexeme==="CLOSE"?t=c(t,A(t)):n.lexeme==="WHITESPACE"&&(t=c(t,M(t,n))),t.offset+=n.word.length;else throw Error(`Could not lex '${t.line[t.offset]}'.`)}return t.tokens}function d(e,t){const n=e.line.slice(e.offset),i=L[t].exec(n);if(i)return{lexeme:t,word:i[0]}}function c(e,t){return e.tokens.push(t),e}function C(e,t){const n=t.word!=="false";return{tag:"Token",lexeme:"BOOLEAN",id:e.tokens.length,offset:e.offset,value:n}}function S(e,t){return{tag:"Token",lexeme:"NUMBER",id:e.tokens.length,offset:e.offset,value:Number(t.word)}}function T(e,t){return{tag:"Token",lexeme:"STRING",id:e.tokens.length,offset:e.offset,value:t.word}}function F(e,t){return{tag:"Token",lexeme:"IDENTIFIER",id:e.tokens.length,offset:e.offset,value:t.word}}function R(e,t){return{tag:"Token",lexeme:"OPEN",id:e.tokens.length,offset:e.offset,value:"("}}function A(e,t){return{tag:"Token",lexeme:"CLOSE",id:e.tokens.length,offset:e.offset,value:")"}}function M(e,t){return{tag:"Token",lexeme:"WHITESPACE",id:e.tokens.length,offset:e.offset,value:t.word}}function f(e){return e.tag==="Token"}function H(e){return f(e)&&e.lexeme==="BOOLEAN"}function D(e){return f(e)&&e.lexeme==="NUMBER"}function G(e){return f(e)&&e.lexeme==="STRING"}function h(e){return f(e)&&e.lexeme==="IDENTIFIER"}function U(e){return f(e)&&e.lexeme==="OPEN"}function m(e){return f(e)&&e.lexeme==="CLOSE"}function k(e){return f(e)&&e.lexeme==="WHITESPACE"}function W(e){return e.tag==="Nested_Boolean"}function z(e){return e.tag==="Nested_Number"}function Z(e){return e.tag==="Nested_String"}function q(e){return e.tag==="Nested_Identifier"}function K(e){return e.tag==="Nested_Binding"}function j(e){return e.tag==="Nested_Lambda"}function J(e){return e.tag==="Nested_Let"}function Q(e){return e.tag==="Nested_If"}function V(e){return e.tag==="Nested_Call"}class X{constructor(t){this.index=0,this.node_count=0,this.tokens=t}peek(){if(0<=this.index&&this.index<this.tokens.length)return this.tokens[this.index];throw Error(`Parser::peek() is out-of-bounds (token ${this.index} of ${this.tokens.length})`)}previous(){if(1<=this.index&&this.index<this.tokens.length+1)return this.tokens[this.index-1];throw Error(`Parser::previous() is out-of-bounds (token ${this.index} of ${this.tokens.length})`)}consume(){this.index++}emit(){const t=this.node_count;return this.node_count++,t}is_at_end(){return this.index===this.tokens.length}expr(){if(this.is_at_end())throw Error(`Parser::expr() is out-of-bounds (token ${this.index} of ${this.tokens.length})`);if(this.skip_whitespace(),H(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Boolean",value:this.previous().value};if(D(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Number",value:this.previous().value};if(G(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_String",value:this.previous().value};if(h(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Identifier",name:this.previous().value};if(U(this.peek())){this.consume(),this.skip_whitespace();const t=this.peek();return h(t)&&t.value==="lambda"?this.lambda():h(t)&&t.value==="let"?this.letbind():h(t)&&t.value==="if"?this.iff():this.call()}else throw m(this.peek())?Error(`Expected an expression but got ')' instead (token ${this.index} of ${this.tokens.length})`):Error(`Unknown token tag '${this.peek()}' (token ${this.index} of ${this.tokens.length})`)}lambda(){const t=this.emit(),n=this.peek();if(this.consume(),this.expect_whitespace(),h(this.peek())){const i=this.binding();this.expect_whitespace();const o=this.expr();return this.skip_whitespace(),this.expect_closing(),{id:t,token:n.id-1,tag:"Nested_Lambda",binding:i,body:o}}else throw new Error(`Expected an 'lambda' to be followed by an identifier but got a ${this.peek().lexeme} instead (token ${this.index} of ${this.tokens.length})`)}letbind(){const t=this.emit(),n=this.peek();if(this.consume(),this.expect_whitespace(),h(this.peek())){const i=this.binding();this.expect_whitespace();const o=this.expr();this.expect_whitespace();const r=this.expr();return this.skip_whitespace(),this.expect_closing(),{id:t,token:n.id-1,tag:"Nested_Let",binding:i,value:o,body:r}}else throw new Error(`Expected an 'let' to be followed by an identifier but got a ${this.peek().lexeme} instead (token ${this.index} of ${this.tokens.length})`)}iff(){const t=this.emit(),n=this.peek();this.consume(),this.expect_whitespace();const i=this.expr();this.expect_whitespace();const o=this.expr();this.expect_whitespace();const r=this.expr();return this.skip_whitespace(),this.expect_closing(),{id:t,token:n.id-1,tag:"Nested_If",condition:i,if_true:o,if_false:r}}call(){const t=this.emit(),n=this.expr();this.expect_whitespace();const i=this.expr();return this.skip_whitespace(),this.expect_closing(),{id:t,token:n.token-1,tag:"Nested_Call",fn:n,arg:i}}binding(){const t=this.emit(),n=this.peek();return this.consume(),{id:t,token:n.id,tag:"Nested_Binding",name:n.value}}skip_whitespace(){for(;!this.is_at_end()&&k(this.peek());)this.consume()}expect_whitespace(){if(this.is_at_end())throw Error(`Parser::expect_whitespace() is out-of-bounds (token ${this.index} of ${this.tokens.length})`);if(k(this.peek()))this.consume();else throw new Error(`Expected a whitespace and another expression, but got a '${this.peek().lexeme}' instead (token ${this.index} of ${this.tokens.length})`)}expect_closing(){if(this.is_at_end())throw Error(`Parser::expect_closing() is out-of-bounds (token ${this.index} of ${this.tokens.length})`);if(m(this.peek()))this.consume();else throw new Error(`Expected ')' but got a '${this.peek().lexeme}' instead (token ${this.index} of ${this.tokens.length})`)}}function Y(e){let t=new X(e);t.skip_whitespace();const n=t.expr();if(t.skip_whitespace(),t.is_at_end())return{ast:n,node_count:t.node_count};throw Error(`Expected a single expression, failed to fully parse input (token ${t.index} of ${t.tokens.length})`)}const b=["==","!=","<",">","<=",">=","+","-","*","/","%","~","&&","||","!"];function p(e,t){return e.tag==="Flat_Literal"}function _(e,t){return e.tag==="Flat_Identifier"}function w(e,t){return e.tag==="Flat_Binding"}function E(e,t){return e.tag==="Flat_Reference"}function y(e,t){return e.tag==="Flat_Lambda"}function $(e,t){return e.tag==="Flat_Let"}function x(e,t){return e.tag==="Flat_If"}function N(e,t){return e.tag==="Flat_Call"}function ee(e,t){return e.tag==="Flat_Builtin"}function te(){return{parent:void 0,bindings:new Map}}function I(e){return{parent:e,bindings:new Map}}function B(e,t){const n=t.bindings.get(e);if(n!==void 0)return n;if(t.parent!==void 0)return B(e,t.parent);throw new Error(`variable with id ${e} is undefined`)}function a(e,t,n){if(p(e))return{tag:"Primitive",value:e.value};if(_(e))throw Error(`Cannot evaluate unresolved reference to '${e.name}' at token ${e.token}`);if(w(e))return B(e.id,n);if(E(e))return a(t[e.target.id],t,n);if(ee(e))return re(e);if(y(e))return{tag:"Closure",binding:e.binding,body:e.body,env:n};if($(e)){let i=I(n);return i.bindings.set(e.binding.id,a(t[e.value.id],t,n)),a(t[e.body.id],t,i)}else if(x(e)){const i=a(t[e.condition.id],t,n);if(g(i)&&typeof i.value=="boolean")return a(t[i.value?e.if_true.id:e.if_false.id],t,n);throw new Error(`Expect condition in 'if' expression to evaluate to a boolean value, evaluated to ${i.tag} instead`)}else if(N(e)){const i=a(t[e.body.id],t,n),o=a(t[e.arg.id],t,n);return ne(i,o,t)}else throw new Error("unhandled case in evaluation control flow")}function ne(e,t,n){if(ie(e)){let i=I(e.env);return i.bindings.set(e.binding.id,t),a(n[e.body.id],n,i)}else if(oe(e)){if(g(t))return e.args.push(t),e.args.length==e.arity?e.impl(e.args):e;throw Error(`Tried calling builtin function '${e.name}' with non-primitive argument of type '${t.tag}'`)}else throw`Attempted to call a non-function value ${e.value} of type ${e.tag}`}function g(e){return e.tag==="Primitive"}function ie(e){return e.tag==="Closure"}function oe(e){return e.tag==="Builtin"}function re(e,t){switch(e.name){case"~":return{tag:"Builtin",name:e.name,arity:1,impl:n=>({tag:"Primitive",value:-n[0].value}),args:[]};case"!":return{tag:"Builtin",name:e.name,arity:1,impl:n=>({tag:"Primitive",value:!n[0].value}),args:[]};case"==":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value==n[1].value}),args:[]};case"!=":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value!=n[1].value}),args:[]};case"<":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value<n[1].value}),args:[]};case">":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value>n[1].value}),args:[]};case"<=":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value<=n[1].value}),args:[]};case">=":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value>=n[1].value}),args:[]};case"+":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value+n[1].value}),args:[]};case"-":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value-n[1].value}),args:[]};case"*":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value*n[1].value}),args:[]};case"/":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value/n[1].value}),args:[]};case"%":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value%n[1].value}),args:[]};case"&&":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value&&n[1].value}),args:[]};case"||":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value||n[1].value}),args:[]}}}function se(e,t){const n=Array(t);return l(e,n)}function l(e,t){if(j(e)){const n=e.id,i={id:e.binding.id},o={id:e.body.id};let r={id:n,token:e.token,tag:"Flat_Lambda",binding:i,body:o};t[n]=r,t=l(e.binding,t),t=l(e.body,t)}else if(J(e)){const n=e.id,i={id:e.binding.id},o={id:e.value.id},r={id:e.body.id};let s={id:n,token:e.token,tag:"Flat_Let",binding:i,value:o,body:r};t[n]=s,t=l(e.binding,t),t=l(e.value,t),t=l(e.body,t)}else if(Q(e)){const n=e.id,i={id:e.condition.id},o={id:e.if_true.id},r={id:e.if_false.id};let s={id:n,token:e.token,tag:"Flat_If",condition:i,if_true:o,if_false:r};t[n]=s,t=l(e.condition,t),t=l(e.if_true,t),t=l(e.if_false,t)}else if(V(e)){const n=e.id,i={id:e.fn.id},o={id:e.arg.id};let r={id:n,token:e.token,tag:"Flat_Call",body:i,arg:o};t[n]=r,t=l(e.fn,t),t=l(e.arg,t)}else if(W(e)||z(e)||Z(e)){const n=e.id;let i={id:n,token:e.token,tag:"Flat_Literal",value:e.value};t[n]=i}else if(q(e)){const n=e.id;let i={id:n,token:e.token,tag:"Flat_Identifier",name:e.name};t[n]=i}else if(K(e)){const n=e.id;let i={id:n,token:e.token,tag:"Flat_Binding",name:e.name};t[n]=i}else throw Error(`Cannot convert nested node of tag '${e.tag}' to a corresponding tag of flat node.`);return t}function le(e){let t=e.map(i=>i),n=de();return u(t[0],t,n)}function u(e,t,n){if(p(e)||w(e)||E(e))return t;if(_(e)){const i=e.id,o=e.token,r=P(e.name,n);if(r==="builtin")if(b.includes(e.name)){const s={id:i,token:o,tag:"Flat_Builtin",name:e.name};t[i]=s}else throw new Error(`'${e.name}' is not a built-in function`);else{const s={id:i,token:o,tag:"Flat_Reference",target:{id:r}};t[i]=s}return t}else if(y(e)){const i=t[e.binding.id],o=t[e.body.id];let r=v(n);return r.bindings.set(i.name,i.id),t=u(o,t,r),t}else if($(e)){const i=t[e.binding.id],o=t[e.value.id],r=t[e.body.id];let s=v(n);return s.bindings.set(i.name,i.id),t=u(o,t,n),t=u(r,t,s),t}else if(N(e)){const i=t[e.body.id],o=t[e.arg.id];return t=u(i,t,n),t=u(o,t,n),t}else if(x(e)){const i=t[e.condition.id],o=t[e.if_true.id],r=t[e.if_false.id];return t=u(i,t,n),t=u(o,t,n),t=u(r,t,n),t}else throw Error(`Name resolution not implemented for node ${e.id} of tag ${e.tag}`)}function P(e,t){if(ue(t)){const n=t.bindings.get(e);if(n!==void 0)return n;throw new Error(`variable with name ${e} is undefined`)}else if(ae(t)){const n=t.bindings.get(e);return n!==void 0?n:P(e,t.parent)}else throw Error("Invalid tag of scope. Something is wrong with the name resolution implementation.")}function ue(e){return e.tag==="GlobalScope"}function ae(e){return e.tag==="Scope"}function v(e){return{tag:"Scope",parent:e,bindings:new Map}}function de(){let e=new Map;for(let t of b)e.set(t,"builtin");return{tag:"GlobalScope",bindings:e}}function ce(e){const t=O(e),n=Y(t),i=se(n.ast,n.node_count),o=le(i);let r=te();const s=a(o[0],o,r);if(g(s))return s.value;throw Error(`Interpreter expected a boolean, number, or string result, but got a '${s.tag}' instead.`)}function fe(){const e=document.getElementById("input"),t=document.getElementById("output");t&&new MutationObserver(()=>{t.scrollTop=t.scrollHeight}).observe(t,{childList:!0});const n=e.value;try{const i=ce(n);t.textContent+=`> ${n}
${i}
`}catch(i){const o=i instanceof Error?i.message:String(i);t.textContent+=`> ${n}
${o}
`}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("help-btn"),t=document.getElementById("help-box");e==null||e.addEventListener("click",()=>{t&&e&&(t.style.display==="block"?(t.style.display="none",e.textContent="Help"):(t.style.display="block",e.textContent="Close Help"))});const n=document.getElementById("output");n&&(n.textContent=`



















Welcome! Try typing:

((+ 1) 2)

and press Enter.

For more info, click on the 'Help'
button in the top-left corner.

`);const i=document.getElementById("input");i==null||i.focus(),i==null||i.setSelectionRange(i.value.length,i.value.length),i==null||i.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),fe())})});
