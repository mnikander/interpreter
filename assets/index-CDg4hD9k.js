(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const o of u.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(r){if(r.ep)return;r.ep=!0;const u=t(r);fetch(r.href,u)}})();function p(e){let n=0,t=!0;for(let r=0;r<e.length;r++)e[r]=="("?n++:e[r]==")"&&n--,n<0&&(t=!1);let i=n==0;return t&&i}function N(e){let n="";for(let t=0;t<e.length;t++)e[t]=="("?n+=" ( ":e[t]==")"?n+=" ) ":n+=e[t];return n}function m(e){return e.kind=="TokenError"}function R(e){return e.kind=="TokenBoolean"}function g(e){return e.kind=="TokenNumber"}function y(e){return e.kind=="TokenIdentifier"}function O(e){return e.kind=="TokenOpenParen"}function V(e){return e.kind=="TokenCloseParen"}function b(e){if(!p(e))return[{kind:"TokenError",value:"invalid parentheses"}];let t=N(e).split(" ");return t=h(t),t.map(T)}function h(e){let n=[];for(let t of e)t!=""&&n.push(t);return n}function T(e){return U(e)??I(e)??L(e)??C(e)??{kind:"TokenError",value:`invalid sequence of characters '${e}'`}}function U(e){if(e=="(")return{kind:"TokenOpenParen",value:"("};if(e==")")return{kind:"TokenCloseParen",value:")"}}function I(e){return e==="True"?{kind:"TokenBoolean",value:!0}:e==="False"?{kind:"TokenBoolean",value:!1}:void 0}function L(e){let n=Number(e);if(!isNaN(n))return{kind:"TokenNumber",value:n}}function C(e){if(/^[_a-zA-Z][_a-zA-Z0-9]*$/.test(e))return{kind:"TokenIdentifier",value:e};if(/^[.,:;!?<>\=\@\#\$\+\-\*\/\%\&\|\^\~]+$/.test(e))return{kind:"TokenIdentifier",value:e}}function F(e){return e.kind=="ND_BOOLEAN"}function A(e){return e.kind=="ND_NUMBER"}function D(e){return e.kind=="ND_IDENTIFIER"}function $(e){return e.kind=="ND_CALL"}function B(e){let[n,t]=c(e,0);return t==e.length?[n,t]:t<e.length?[{kind:"ND_ERROR",value:"expected a single expression"},t]:[{kind:"ND_ERROR",value:"not all tokens could be evaluated"},t]}function c(e,n=0){if(n<e.length){let t=e[n];if(R(t))return n++,[{kind:"ND_BOOLEAN",value:t.value},n];if(g(t))return n++,[{kind:"ND_NUMBER",value:t.value},n];if(y(t))return n++,[{kind:"ND_IDENTIFIER",value:t.value},n];if(O(t)){n++;let i={kind:"ND_ERROR",value:"could not parse function"},r=[];for([i,n]=c(e,n);n<e.length;){if(V(e[n]))return n++,[{kind:"ND_CALL",func:i,params:r},n];{let u={kind:"ND_ERROR",value:"could not parse expression"};[u,n]=c(e,n),r.push(u)}}return[{kind:"ND_ERROR",value:"expected closing parentheses"},n]}else return n++,[{kind:"ND_ERROR",value:`unable to parse token of kind ${e[n].kind}`},n]}else return[{kind:"ND_ERROR",value:"expected another token"},n]}function d(e){if(e.kind=="ND_ERROR")return e.value;if(e.kind=="ND_CALL"){const n=d(e.func);if(n!==void 0)return n;for(let t of e.params){const i=d(t);if(i!==void 0)return i}return}else return}const l=new Map([["+",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e+n},about:"(+ 5 2)		addition"}],["-",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e-n},about:"(- 5 2)		subtraction"}],["*",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e*n},about:"(* 5 2)		multiplication"}],["/",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e/n},about:"(/ 5 2)		division"}],["%",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e%n},about:"(% 5 2)		remainder after division"}],["<",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e<n},about:"(< 5 2)		less than"}],[">",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e>n},about:"(> 5 2)		greater than"}],["<=",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e<=n},about:"(<= 5 2)	less than or equal to"}],[">=",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e>=n},about:"(>= 5 2)	greater than or equal to"}],["==",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e==n},about:"(== 5 2)	equal to"}],["!=",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e!=n},about:"(!= 5 2)	unequal to"}],["&",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e&&n},about:"(& True False)	logical and"}],["|",{kind:"EV_FUNCTION",arity:2,value:function(e,n){return e||n},about:"(| True False)	logical or"}],["!",{kind:"EV_FUNCTION",arity:1,value:function(e){return!e},about:"(! True)	logical negation"}],["if",{kind:"EV_FUNCTION",arity:3,value:function(e,n,t){return e?n:t},about:"(if (< 0 1) 4 8) if-expression"}],["help",{kind:"EV_FUNCTION",arity:0,value:function(){return v(l)},about:"(help)		prints this dialog"}],["Help",{kind:"EV_FUNCTION",arity:0,value:function(){return v(l)},about:"(Help)		prints this dialog"}]]);function v(e){let n=`
Symbol	Usage		Name
------------------------------------------------
`;for(const[t,i]of e.entries())i.arity!==void 0&&(n+=`${t}	${i.about}
`);return n}function k(e,n){return n.get(String(e.value))}function a(e){if(F(e))return{kind:"EV_VALUE",value:e.value};if(A(e))return{kind:"EV_VALUE",value:e.value};if(D(e)){const n=e,t=k(n,l);return t!==void 0?t:{kind:"EV_ERROR",message:`unknown identifier '${n.value}'`}}else if($(e)){const n=e,t=n.func,i=k(t,l);if((i==null?void 0:i.kind)==="EV_FUNCTION"){if(i.arity==0&&n.params.length==0){const r=i.value;return{kind:"EV_VALUE",value:r()}}if(i.arity==1&&n.params.length==1){const r=a(n.params[0]);if(r.kind==="EV_VALUE"){const u=i.value,o=r.value;return{kind:"EV_VALUE",value:u(o)}}else return r}if(i.arity==2&&n.params.length==2){const r=a(n.params[0]),u=a(n.params[1]);if(r.kind==="EV_VALUE")if(u.kind==="EV_VALUE"){const o=i.value,s=r.value,f=u.value;return{kind:"EV_VALUE",value:o(s,f)}}else return u;else return r}if(i.arity==3&&n.params.length==3){const r=a(n.params[0]),u=a(n.params[1]),o=a(n.params[2]);if(r.kind==="EV_VALUE")if(u.kind==="EV_VALUE")if(o.kind==="EV_VALUE"){const s=i.value,f=r.value,_=u.value,E=o.value;return{kind:"EV_VALUE",value:s(f,_,E)}}else return o;else return u;else return r}else return{kind:"EV_ERROR",message:`${n.params.length} argument(s) provided, expected ${i.arity}`}}else{const r=n.func;let u=`expected a function identifier, got '${r.value}'`;return typeof r.value=="number"&&(u+=`.
Maybe you forgot a space between a '+' or '-' and a number`),{kind:"EV_ERROR",message:u}}}return{kind:"EV_ERROR",message:"invalid expression"}}function P(e){const n=b(e),t=n.find(m);if(t!==void 0)return"ERROR: "+(t.value??"unknown error during lexing")+". ";const[i,r]=B(n),u=d(i);if(u!==void 0)return"ERROR: "+(u??"unknown error during parsing")+". ";const o=a(i);return o.kind==="EV_VALUE"?o.value:o.kind==="EV_ENTRY"?"ERROR: result is a function. ":o.kind==="EV_ERROR"?`ERROR: ${o.message}. `:"ERROR: unknown evaluation error. "}function M(){const e=document.getElementById("input"),n=document.getElementById("output");n&&new MutationObserver(()=>{n.scrollTop=n.scrollHeight}).observe(n,{childList:!0});const t=e.value,i=P(t);n.textContent+=`> ${t}
${i}
`}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("output");e&&(e.textContent=`Welcome! Try typing:

(+ 1 2)

and press Enter. For more info run:

(help)

`);const n=document.getElementById("input");n==null||n.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),M())})});
