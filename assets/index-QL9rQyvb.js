(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const _={BOOLEAN:/^(true|false)/,NUMBER:/^[-+]?(?:\d*\.\d+|\d+\.\d*|\d+)/,STRING:/^"(\\.|[^"\\])*"|^'(\\.|[^'\\])*'/,IDENTIFIER:/^(?:([_a-zA-Z][_a-zA-Z0-9]*)|([.,:;!?<>\=\@\#\$\+\-\*\/\%\&\|\^\~]+))/,LAMBDA:/^lambda/,LET:/^let/,ASSIGN:/^=/,IN:/^in/,IF:/^if/,THEN:/^then/,ELSE:/^else/,WHITESPACE:/^\s+/,OPEN:/^\(/,CLOSE:/^\)/,EOF:/^/};function D(e){let t={tag:"State",offset:0,line:e,tokens:[]};for(;t.offset<t.line.length;){const n=g(t,"BOOLEAN")??g(t,"NUMBER")??g(t,"STRING")??m(t,"LAMBDA")??m(t,"LET")??m(t,"ASSIGN")??m(t,"IN")??m(t,"IF")??m(t,"THEN")??m(t,"ELSE")??g(t,"IDENTIFIER")??g(t,"WHITESPACE")??g(t,"OPEN")??g(t,"CLOSE");if(n)n.lexeme==="BOOLEAN"?t=u(t,G(t,n)):n.lexeme==="NUMBER"?t=u(t,U(t,n)):n.lexeme==="STRING"?t=u(t,W(t,n)):n.lexeme==="LAMBDA"?t=u(t,Z(t)):n.lexeme==="LET"?t=u(t,q(t)):n.lexeme==="ASSIGN"?t=u(t,K(t)):n.lexeme==="IN"?t=u(t,j(t)):n.lexeme==="IF"?t=u(t,J(t)):n.lexeme==="THEN"?t=u(t,Q(t)):n.lexeme==="ELSE"?t=u(t,V(t)):n.lexeme==="IDENTIFIER"?t=u(t,z(t,n)):n.lexeme==="OPEN"?t=u(t,X(t)):n.lexeme==="CLOSE"?t=u(t,Y(t)):n.lexeme==="WHITESPACE"&&(t=u(t,ee(t,n))),t.offset+=n.word.length;else throw Error(`Could not lex '${t.line[t.offset]}'.`)}return t=u(t,te(t)),t.tokens}function a(e,t){return H(e)&&e.lexeme===t}function H(e){return e.tag==="Token"}function g(e,t){const n=e.line.slice(e.offset),i=_[t].exec(n);if(i)return{lexeme:t,word:i[0]}}function m(e,t){const n=e.line.slice(e.offset),i=_[t].exec(n);if(i){n.slice(i[0].length);const o={offset:e.offset+i[0].length,line:e.line,tokens:e.tokens};return g(o,"OPEN")??g(o,"CLOSE")??g(o,"WHITESPACE")?{lexeme:t,word:i[0]}:void 0}else return}function u(e,t){return e.tokens.push(t),e}function G(e,t){const n=t.word!=="false";return{tag:"Token",lexeme:"BOOLEAN",at:e.tokens.length,offset:e.offset,value:n}}function U(e,t){return{tag:"Token",lexeme:"NUMBER",at:e.tokens.length,offset:e.offset,value:Number(t.word)}}function W(e,t){return{tag:"Token",lexeme:"STRING",at:e.tokens.length,offset:e.offset,value:t.word}}function z(e,t){return{tag:"Token",lexeme:"IDENTIFIER",at:e.tokens.length,offset:e.offset,value:t.word}}function Z(e,t){return{tag:"Token",lexeme:"LAMBDA",at:e.tokens.length,offset:e.offset,value:"lambda"}}function q(e,t){return{tag:"Token",lexeme:"LET",at:e.tokens.length,offset:e.offset,value:"let"}}function K(e,t){return{tag:"Token",lexeme:"ASSIGN",at:e.tokens.length,offset:e.offset,value:"="}}function j(e,t){return{tag:"Token",lexeme:"IN",at:e.tokens.length,offset:e.offset,value:"in"}}function J(e,t){return{tag:"Token",lexeme:"IF",at:e.tokens.length,offset:e.offset,value:"if"}}function Q(e,t){return{tag:"Token",lexeme:"THEN",at:e.tokens.length,offset:e.offset,value:"then"}}function V(e,t){return{tag:"Token",lexeme:"ELSE",at:e.tokens.length,offset:e.offset,value:"else"}}function X(e,t){return{tag:"Token",lexeme:"OPEN",at:e.tokens.length,offset:e.offset,value:"("}}function Y(e,t){return{tag:"Token",lexeme:"CLOSE",at:e.tokens.length,offset:e.offset,value:")"}}function ee(e,t){return{tag:"Token",lexeme:"WHITESPACE",at:e.tokens.length,offset:e.offset,value:t.word}}function te(e){return{tag:"Token",lexeme:"EOF",at:e.tokens.length,offset:e.offset,value:"EOF"}}function ne(e){let t=[],n=0;for(let i=0;i<e.length;i++){const o=e[i];if(a(o,"OPEN"))t.push(re(n,o.offset)),n++,t.push(k(n,o.offset)),n++;else if(a(o,"CLOSE"))t.push(k(n,o.offset)),n++,t.push(le(n,o.offset)),n++;else{let r=o;r.at=n,n++,t.push(r)}}return t}function ie(e){let t=!1;for(let n=0;n<e.length;n++){const i=e[n];if(t)if(a(i,"WHITESPACE")||a(i,"EOF"))t=!1;else throw Error(`Expected whitespace between tokens '${e[n-1].value}' and '${e[n].value}'.`);else a(i,"WHITESPACE")||(t=!0)}return!0}function oe(e){let t=[],n=0;for(let i=0;i<e.length;i++){const o=e[i];if(!a(o,"WHITESPACE")){let r=o;r.at=n,t.push(r),n++}}return t}function k(e,t){return{tag:"Token",lexeme:"WHITESPACE",at:e,offset:t,value:" "}}function re(e,t){return{tag:"Token",lexeme:"OPEN",at:e,offset:t,value:"("}}function le(e,t){return{tag:"Token",lexeme:"CLOSE",at:e,offset:t,value:")"}}function p(e){return e.tag==="_Block"}function y(e){return e.tag==="_LetBind"}function I(e){return e.tag==="_Lambda"}function N(e){return e.tag==="_Call"}function w(e){return e.tag==="_IfThenElse"}function ue(e){return e.tag==="_Binding"}function ae(e){return e.tag==="_Identifier"}function ce(e){return e.tag==="_Boolean"}function se(e){return e.tag==="_Number"}function fe(e){return e.tag==="_String"}function c(e,t,n){t.pre&&t.pre(e,n),p(e)?c(e.body,t,n):y(e)?(c(e.binding,t,n),c(e.value,t,n),c(e.body,t,n)):I(e)?(c(e.binding,t,n),c(e.body,t,n)):N(e)?(c(e.fn,t,n),c(e.arg,t,n)):w(e)&&(c(e.condition,t,n),c(e.then_branch,t,n),c(e.else_branch,t,n)),t.post&&t.post(e,n)}const f=-1;function de(e){const t=oe(e);let n=new he(t),i=n.block(),o={index:0};if(c(i,{pre:(l,E)=>{l.id=E.index,E.index++}},o),!n.at_end())throw Error(`Expected input to be one program. A second program begins at token '${n.peek().value}' of type '${n.peek().lexeme}'.`);return{ast:i,node_count:o.index}}class he{constructor(t){this.index=0,this.tokens=t}at_end(){return a(this.peek(),"EOF")}peek(){if(0<=this.index&&this.index>=this.tokens.length)throw Error("Current token is out of bounds.");return this.tokens[this.index]}previous(){if(0<=this.index-1&&this.index-1>=this.tokens.length)throw Error("Previous token is out of bounds.");return this.tokens[this.index-1]}advance(){this.index++}check(t){if(a(this.peek(),t))return t}check_any(t){let n;for(let i=0;i<t.length;i++)n=n??this.check(t[i]);return n}match(t){if(a(this.peek(),t))return this.advance(),t}report_expected(t){const n=t.reduce((i,o)=>`${i}'${o}', `,"");return Error(`Expected '${n}' got '${this.peek().value}' of type '${this.peek().lexeme}'.`)}block(){const t=this.index;if(!this.match("OPEN"))throw this.report_expected(["OPEN"]);const n=this.content();if(!this.match("CLOSE"))throw this.report_expected(["CLOSE"]);return{id:f,token:t,tag:"_Block",body:n}}letbind(){const t=this.index;if(!this.match("LET"))throw this.report_expected(["LET"]);const n=this.binding();if(!this.match("ASSIGN"))throw this.report_expected(["ASSIGN"]);const i=this.atomic_or_call();if(!this.match("IN"))throw this.report_expected(["IN"]);const o=this.content();return{id:f,token:t,tag:"_LetBind",binding:n,value:i,body:o}}content(){let t;return a(this.peek(),"LET")?t=this.letbind():t=this.tail(),t}lambda(){const t=this.index;if(!this.match("LAMBDA"))throw this.report_expected(["LAMBDA"]);const n=this.binding(),i=this.block();return{id:f,token:t,tag:"_Lambda",binding:n,body:i}}if_then_else(){const t=this.index;if(!this.match("IF"))throw this.report_expected(["IF"]);const n=this.atomic_or_call();if(!this.match("THEN"))throw this.report_expected(["THEN"]);const i=this.block();if(!this.match("ELSE"))throw this.report_expected(["ELSE"]);const o=this.block();return{id:f,token:t,tag:"_IfThenElse",condition:n,then_branch:i,else_branch:o}}tail(){if(this.is_token_atomic())return this.atomic_or_call();if(this.is_token_complex())return this.complex();throw this.report_expected(["BOOLEAN","NUMBER","STRING","IDENTIFIER","LAMBDA","OPEN","IF"])}atomic_or_call(){const t=this.index,n=this.atomic();if(this.is_token_atomic()){const i=this.atomic();return{id:f,token:t,tag:"_Call",fn:n,arg:i}}else return n}atomic(){const t=this.peek();if(this.is_token_literal())return this.literal();if(a(t,"IDENTIFIER"))return this.identifier();if(a(t,"LAMBDA"))return this.lambda();if(a(t,"OPEN"))return this.block();throw this.report_expected(["BOOLEAN","NUMBER","STRING","IDENTIFIER","LAMBDA","OPEN"])}is_token_atomic(){return this.check_any(["BOOLEAN","NUMBER","STRING","IDENTIFIER","LAMBDA","OPEN"])}complex(){const t=this.peek();if(a(t,"IF"))return this.if_then_else();throw this.report_expected(["IF"])}is_token_complex(){return this.check_any(["IF"])}binding(){const t=this.index;if(this.match("IDENTIFIER"))return{id:f,token:t,tag:"_Binding",name:this.previous().value};throw this.report_expected(["IDENTIFIER"])}identifier(){const t=this.index;if(this.match("IDENTIFIER"))return{id:f,token:t,tag:"_Identifier",name:this.previous().value};throw this.report_expected(["IDENTIFIER"])}literal(){const t=this.index;if(this.match("BOOLEAN"))return{id:f,token:t,tag:"_Boolean",value:this.previous().value};if(this.match("NUMBER"))return{id:f,token:t,tag:"_Number",value:this.previous().value};if(this.match("STRING"))return{id:f,token:t,tag:"_String",value:this.previous().value};throw this.report_expected(["BOOLEAN","NUMBER","STRING"])}is_token_literal(){return this.check_any(["BOOLEAN","NUMBER","STRING"])}}const T=["==","!=","<",">","<=",">=","+","-","*","/","%","~","&&","||","!"];function B(e,t){return e.tag==="Flat_Block"}function L(e,t){return e.tag==="Flat_Let"}function S(e,t){return e.tag==="Flat_Lambda"}function O(e,t){return e.tag==="Flat_Call"}function ge(e,t){return e.tag==="Flat_Builtin"}function A(e,t){return e.tag==="Flat_If"}function F(e,t){return e.tag==="Flat_Identifier"}function P(e,t){return e.tag==="Flat_Binding"}function $(e,t){return e.tag==="Flat_Reference"}function C(e,t){return e.tag==="Flat_Literal"}function me(){return{parent:void 0,bindings:new Map}}function R(e){return{parent:e,bindings:new Map}}function x(e,t){const n=t.bindings.get(e);if(n!==void 0)return n;if(t.parent!==void 0)return x(e,t.parent);throw new Error(`variable with id ${e} is undefined`)}function h(e,t,n){if(B(e))return h(t[e.body.id],t,n);if(C(e))return{tag:"Primitive",value:e.value};if(F(e))throw Error(`Cannot evaluate unresolved reference to '${e.name}' at token ${e.token}`);if(P(e))return x(e.id,n);if($(e))return h(t[e.target.id],t,n);if(ge(e))return ve(e);if(S(e))return{tag:"Closure",binding:e.binding,body:e.body,env:n};if(L(e)){let i=R(n);return i.bindings.set(e.binding.id,h(t[e.value.id],t,n)),h(t[e.body.id],t,i)}else if(A(e)){const i=h(t[e.condition.id],t,n);if(b(i)&&typeof i.value=="boolean")return h(t[i.value?e.then_branch.id:e.else_branch.id],t,n);throw new Error(`Expect condition in 'if' expression to evaluate to a boolean value, evaluated to ${i.tag} instead`)}else if(O(e)){const i=h(t[e.body.id],t,n),o=h(t[e.arg.id],t,n);return be(i,o,t)}else throw new Error("unhandled case in evaluation control flow")}function be(e,t,n){if(Ee(e)){let i=R(e.env);return i.bindings.set(e.binding.id,t),h(n[e.body.id],n,i)}else if(ke(e)){if(b(t))return e.args.push(t),e.args.length==e.arity?e.impl(e.args):e;throw Error(`Tried calling builtin function '${e.name}' with non-primitive argument of type '${t.tag}'`)}else throw`Expected a function, but got '${e.value}' of type '${e.tag}'`}function b(e){return e.tag==="Primitive"}function Ee(e){return e.tag==="Closure"}function ke(e){return e.tag==="Builtin"}function ve(e,t){switch(e.name){case"~":return{tag:"Builtin",name:e.name,arity:1,impl:n=>({tag:"Primitive",value:-n[0].value}),args:[]};case"!":return{tag:"Builtin",name:e.name,arity:1,impl:n=>({tag:"Primitive",value:!n[0].value}),args:[]};case"==":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value==n[1].value}),args:[]};case"!=":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value!=n[1].value}),args:[]};case"<":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value<n[1].value}),args:[]};case">":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value>n[1].value}),args:[]};case"<=":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value<=n[1].value}),args:[]};case">=":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value>=n[1].value}),args:[]};case"+":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value+n[1].value}),args:[]};case"-":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value-n[1].value}),args:[]};case"*":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value*n[1].value}),args:[]};case"/":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value/n[1].value}),args:[]};case"%":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value%n[1].value}),args:[]};case"&&":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value&&n[1].value}),args:[]};case"||":return{tag:"Builtin",name:e.name,arity:2,impl:n=>({tag:"Primitive",value:n[0].value||n[1].value}),args:[]}}}function _e(e,t){const n=Array(t);return s(e,n)}function s(e,t){if(p(e)){const n=e.id,i={id:e.body.id};let o={id:n,token:e.token,tag:"Flat_Block",body:i};t[n]=o,t=s(e.body,t)}else if(I(e)){const n=e.id,i={id:e.binding.id},o={id:e.body.id};let r={id:n,token:e.token,tag:"Flat_Lambda",binding:i,body:o};t[n]=r,t=s(e.binding,t),t=s(e.body,t)}else if(y(e)){const n=e.id,i={id:e.binding.id},o={id:e.value.id},r={id:e.body.id};let l={id:n,token:e.token,tag:"Flat_Let",binding:i,value:o,body:r};t[n]=l,t=s(e.binding,t),t=s(e.value,t),t=s(e.body,t)}else if(w(e)){const n=e.id,i={id:e.condition.id},o={id:e.then_branch.id},r={id:e.else_branch.id};let l={id:n,token:e.token,tag:"Flat_If",condition:i,then_branch:o,else_branch:r};t[n]=l,t=s(e.condition,t),t=s(e.then_branch,t),t=s(e.else_branch,t)}else if(N(e)){const n=e.id,i={id:e.fn.id},o={id:e.arg.id};let r={id:n,token:e.token,tag:"Flat_Call",body:i,arg:o};t[n]=r,t=s(e.fn,t),t=s(e.arg,t)}else if(ce(e)||se(e)||fe(e)){const n=e.id;let i={id:n,token:e.token,tag:"Flat_Literal",value:e.value};t[n]=i}else if(ae(e)){const n=e.id;let i={id:n,token:e.token,tag:"Flat_Identifier",name:e.name};t[n]=i}else if(ue(e)){const n=e.id;let i={id:n,token:e.token,tag:"Flat_Binding",name:e.name};t[n]=i}else throw Error(`Cannot convert nested node of tag '${e.tag}' to a corresponding tag of flat node.`);return t}function pe(e){let t=e.map(i=>i),n=Ne();return d(t[0],t,n)}function d(e,t,n){if(C(e)||P(e)||$(e))return t;if(F(e)){const i=e.id,o=e.token,r=M(e.name,n);if(r==="builtin")if(T.includes(e.name)){const l={id:i,token:o,tag:"Flat_Builtin",name:e.name};t[i]=l}else throw new Error(`'${e.name}' is not a built-in function`);else{const l={id:i,token:o,tag:"Flat_Reference",target:{id:r}};t[i]=l}return t}else if(S(e)){const i=t[e.binding.id],o=t[e.body.id];let r=v(n);return r.bindings.set(i.name,i.id),t=d(o,t,r),t}else if(L(e)){const i=t[e.binding.id],o=t[e.value.id],r=t[e.body.id];let l=v(n);return l.bindings.set(i.name,i.id),t=d(o,t,n),t=d(r,t,l),t}else if(O(e)){const i=t[e.body.id],o=t[e.arg.id];return t=d(i,t,n),t=d(o,t,n),t}else if(B(e)){const i=t[e.body.id];return t=d(i,t,n),t}else if(A(e)){const i=t[e.condition.id],o=t[e.then_branch.id],r=t[e.else_branch.id];return t=d(i,t,n),t=d(o,t,n),t=d(r,t,n),t}else throw Error(`Name resolution not implemented for node ${e.id} of tag ${e.tag}`)}function M(e,t){if(ye(t)){const n=t.bindings.get(e);if(n!==void 0)return n;throw new Error(`variable with name ${e} is undefined`)}else if(Ie(t)){const n=t.bindings.get(e);return n!==void 0?n:M(e,t.parent)}else throw Error("Invalid tag of scope. Something is wrong with the name resolution implementation.")}function ye(e){return e.tag==="GlobalScope"}function Ie(e){return e.tag==="Scope"}function v(e){return{tag:"Scope",parent:e,bindings:new Map}}function Ne(){let e=new Map;for(let t of T)e.set(t,"builtin");return{tag:"GlobalScope",bindings:e}}function we(e){let t=0;for(let n=0;n<e.length;n++)if(e[n]=="("?t++:e[n]==")"&&t--,t<0)throw Error(`Unbalanced parentheses. Expected '(' before character ${n}.`);if(t!=0)throw Error(`Unbalanced parentheses. Expected ${t} more ')'.`);return!0}function Te(e){we(e);const t=D(e);ie(ne(t));const n=de(t),i=_e(n.ast,n.node_count),o=pe(i);let r=me();const l=h(o[0],o,r);if(b(l))return l.value;throw Error(`Expected final result to be a boolean, number, or string, got a '${l.tag}' instead`)}function Be(){const e=document.getElementById("input"),t=document.getElementById("output");t&&new MutationObserver(()=>{t.scrollTop=t.scrollHeight}).observe(t,{childList:!0});const n=e.value;try{const i=Te(n);t.textContent+=`> ${n}
${i}
`}catch(i){const o=i instanceof Error?i.message:String(i);t.textContent+=`> ${n}
${o}
`}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("help-btn"),t=document.getElementById("help-box");e==null||e.addEventListener("click",()=>{t&&e&&(t.style.display==="block"?(t.style.display="none",e.textContent="Help"):(t.style.display="block",e.textContent="Close Help"))});const n=document.getElementById("output");n&&(n.textContent=`















Welcome! Try typing:

((+ 1) 2)

and press Enter.

For more info, click on the 'Help'
button in the top-left corner.

`);const i=document.getElementById("input");i==null||i.focus(),i==null||i.setSelectionRange(i.value.length,i.value.length),i==null||i.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),Be())})});
