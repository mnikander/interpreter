(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();const d={whitespace:function(e,n,r){return{kind:"Token",subkind:"Whitespace",id:e,offset:n,value:r}},open:function(e,n,r){return{kind:"Token",subkind:"Open",id:e,offset:n,value:"("}},close:function(e,n,r){return{kind:"Token",subkind:"Close",id:e,offset:n,value:")"}},boolean:function(e,n,r){return r==="false"||r==="False"?{kind:"Token",subkind:"Boolean",id:e,offset:n,value:!1}:{kind:"Token",subkind:"Boolean",id:e,offset:n,value:!0}},number:function(e,n,r){return{kind:"Token",subkind:"Number",id:e,offset:n,value:Number(r)}},string:function(e,n,r){return{kind:"Token",subkind:"String",id:e,offset:n,value:r}},identifier:function(e,n,r){return{kind:"Token",subkind:"Identifier",id:e,offset:n,value:r}}},f={whitespace:function(e){return e.kind==="Token"&&e.subkind==="Whitespace"},open:function(e){return e.kind==="Token"&&e.subkind==="Open"},close:function(e){return e.kind==="Token"&&e.subkind==="Close"},boolean:function(e){return e.kind==="Token"&&e.subkind==="Boolean"},number:function(e){return e.kind==="Token"&&e.subkind==="Number"},string:function(e){return e.kind==="Token"&&e.subkind==="String"},identifier:function(e){return e.kind==="Token"&&e.subkind==="Identifier"}};function c(e,n,r){return{kind:"Error",subkind:e,token_id:r,message:n}}function _(e,n){return`${e.subkind} error: ${e.message} '${n[e.token_id].value}'`}function l(e){return e.ok===!0}function k(e){return e.ok===!1}const s={whitespace:{description:"a whitespace character",regex:/^\s/},open:{description:"(",regex:/\(/},close:{description:")",regex:/\)/},bool:{description:"a boolean",regex:/^(true|false)/},int:{description:"an integer",regex:/^[-+]?[0-9]+/},float:{description:"a float",regex:/^[-+]?((\d+\.\d*)|(\d*\.\d+))/},string:{description:"a string",regex:/^"(\\.|[^"\\])*"|'(\\.|[^'\\])*'/},id_alphanum:{description:"an alphanumeric identifier",regex:/^[_a-zA-Z][_a-zA-Z0-9]*/},id_special:{description:"an operation identifier",regex:/^[.,:;!?<>\=\@\#\$\+\-\*\/\%\&\|\^\~]+/}};function I(e){let n={ok:!0,value:{kind:"State",index:0,line:e,tokens:[]}};for(;l(n);)if(n.value.line.length>0)n=N(n.value);else return{ok:!0,value:n.value.tokens};return n}function N(e){let n={ok:!0,value:e};return n=a(s.whitespace,d.whitespace,e),l(n)||(n=a(s.open,d.open,e),l(n))||(n=a(s.close,d.close,e),l(n))||(n=a(s.bool,d.boolean,e),l(n))||(n=a(s.float,d.number,e),l(n))||(n=a(s.int,d.number,e),l(n))||(n=a(s.string,d.string,e),l(n))||(n=a(s.id_alphanum,d.identifier,e),l(n))||(n=a(s.id_special,d.identifier,e),l(n))?n:{ok:!1,error:{kind:"Error",subkind:"Lexing",token_id:e.tokens.length,message:"invalid token, expected an atom"}}}function a(e,n,r){const o=e.regex.exec(r.line);if(o&&o.index===0){const t=o[0];return r.index+=t.length,r.line=r.line.slice(t.length),n!==void 0&&r.tokens.push(n(r.tokens.length,r.index,t)),{ok:!0,value:r}}else return{ok:!1,error:{kind:"Error",subkind:"Lexing",token_id:r.tokens.length,message:`invalid token, expected ${e.description}`}}}function h(e){return e.kind==="Call"}function E(e){return h(e)&&e.data.length===4&&m(e.data[0])&&e.data[0].value==="let"&&m(e.data[1])}function S(e){return e.kind==="Boolean"}function L(e){return e.kind==="Number"}function $(e){return e.kind==="String"}function m(e){return e.kind==="Identifier"}function C(e,n,r){return{kind:"Call",token_id:n.id,node_id:e,data:r}}function A(e,n){return{kind:n.subkind,token_id:n.id,node_id:e,value:n.value}}function q(e){return M({token_index:0,node_counter:0,tokens:e}).result}function M(e){let n=v(e);return e=n.state,e=p(e),e.token_index!==e.tokens.length?{state:e,result:{ok:!1,error:c("Parsing","expected a single expression at",e.token_index)}}:{state:e,result:n.result}}function v(e){e=p(e);const n=W(e);if(l(n.result))return n;const r=H(e);return l(r.result)?r:{state:e,result:{ok:!1,error:c("Parsing","an expression at",e.token_index)}}}function H(e){if(e.token_index==e.tokens.length||!f.open(e.tokens[e.token_index]))return{state:e,result:{ok:!1,error:c("Parsing","a function call, expected '('",e.token_index)}};{let n=C(e.node_counter,e.tokens[e.token_index],[]);e=O(e),e=p(e);const r=v(e);if(k(r.result))return r;for(e=r.state,n.data.push(r.result.value);e.token_index<e.tokens.length&&f.whitespace(e.tokens[e.token_index]);){e=p(e);const o=v(e);if(k(o.result))break;e=o.state,n.data.push(o.result.value)}return e=p(e),e.token_index==e.tokens.length||!f.close(e.tokens[e.token_index])?{state:e,result:{ok:!1,error:c("Parsing","a function call, expected ')'",e.token_index)}}:(e.token_index++,{state:e,result:{ok:!0,value:n}})}}function W(e){const n=e.tokens[e.token_index];if(e.token_index<e.tokens.length&&(f.boolean(n)||f.number(n)||f.string(n)||f.identifier(n))){let r=A(e.node_counter,n);return e=O(e),{state:e,result:{ok:!0,value:r}}}return{state:e,result:{ok:!1,error:c("Parsing","an atom, expected a boolean, number, string, or identifier",e.token_index)}}}function p(e){let n=e.token_index;for(;n<e.tokens.length&&f.whitespace(e.tokens[n]);)n++;return{token_index:n,node_counter:e.node_counter,tokens:e.tokens}}function O(e){return{token_index:e.token_index+1,node_counter:e.node_counter+1,tokens:e.tokens}}function b(e,n){if(S(e)||L(e)||$(e))return{ok:!0,value:e.value};if(m(e)){const r=P(e.value,n);return r!==void 0?{ok:!0,value:r}:{ok:!1,error:c("Evaluation","identifier",e.token_id)}}else if(E(e)){const r=e.data[1],o=b(e.data[2],n);if(!o.ok)return o;const t=e.data[3];let i={parent:n,symbols:new Map};return i.symbols.set(r.value,o.value),b(t,i)}else if(h(e)){let r=e.data.map(u=>b(u,n));for(let u of r)if(k(u))return u;const o=r.map(u=>u.value),t=o[0],i=o.slice(1);return{ok:!0,value:t(i)}}else return{ok:!1,error:c("Evaluation","unknown AST node",e.token_id)}}const w={parent:void 0,symbols:new Map([["+",function(e){return e[0]+e[1]}],["-",function(e){return e[0]-e[1]}],["*",function(e){return e[0]*e[1]}],["/",function(e){return e[0]/e[1]}],["%",function(e){return e[0]%e[1]}],["<",function(e){return e[0]<e[1]}],[">",function(e){return e[0]>e[1]}],["<=",function(e){return e[0]<=e[1]}],[">=",function(e){return e[0]>=e[1]}],["==",function(e){return e[0]==e[1]}],["!=",function(e){return e[0]!=e[1]}],["&",function(e){return e[0]&&e[1]}],["|",function(e){return e[0]||e[1]}],["!",function(e){return!e[0]}],["if",function(e){return e[0]?e[1]:e[2]}],["help",function(e){return T()}],["Help",function(e){return T()}]])};function P(e,n){const r=n.symbols.get(String(e));return r!==void 0?r:n.parent!==void 0?P(e,n.parent):void 0}const z=[{op:"help",example:"(help)		",about:"prints this dialog"},{op:"Help",example:"(Help)		",about:"prints this dialog"},{op:"+",example:"(+ 5 2)		",about:"addition"},{op:"-",example:"(- 5 2)		",about:"subtraction"},{op:"*",example:"(* 5 2)		",about:"multiplication"},{op:"/",example:"(/ 5 2)		",about:"division"},{op:"%",example:"(% 5 2)		",about:"remainder after division"},{op:"<",example:"(< 5 2)		",about:"less than"},{op:">",example:"(> 5 2)		",about:"greater than"},{op:"<=",example:"(<= 5 2)	",about:"less than or equal to"},{op:">=",example:"(>= 5 2)	",about:"greater than or equal to"},{op:"==",example:"(== 5 2)	",about:"equal to"},{op:"!=",example:"(!= 5 2)	",about:"unequal to"},{op:"&",example:"(& True False)	",about:"logical and"},{op:"|",example:"(| True False)	",about:"logical or"},{op:"!",example:"(! True)	",about:"logical negation"},{op:"if",example:"(if True 4 8)	",about:"if-expression"},{op:"let",example:"(let x 5 (* 2 x))",about:"variables in expressions"}];function T(){const e=`--------------------------------------------------------
`;let n=`
Symbol	Usage			Name
`+e;for(const r of z)n+=`${r.op}	${r.example}	${r.about}
`;return n+=e,n+=`You can write nested expressions, such as:

(+ 1 (* 2 4))
`,n+=e,n}function x(e,n){if(S(e)||L(e)||$(e))return{ok:!0,value:void 0};if(m(e))return B(e.value,n)?{ok:!0,value:void 0}:{ok:!1,error:c("Semantic","unknown identifier",e.token_id)};if(E(e)){const r=e.data[1],o=e.data[2],t=e.data[3];if(!m(r))return{ok:!1,error:c("Semantic","not a valid identifier",r.token_id)};const u=x(o,n);if(!u.ok)return u;let g={parent:n,symbols:new Set};g.symbols.add(r.value);const y=x(t,g);return y.ok?{ok:!0,value:void 0}:y}else if(h(e)){for(let r of e.data){const o=x(r,n);if(!o.ok)return{ok:!1,error:o.error}}return{ok:!0,value:void 0}}else return{ok:!1,error:c("Semantic","unknown kind of AST entry",e.token_id)}}function B(e,n){return n.symbols.has(e)?!0:n.parent!==void 0?B(e,n.parent):!1}function D(e){const n=I(e);if(k(n))return _(n.error,[]);const r=n.value,o=q(r);if(k(o))return _(o.error,r);const t=x(o.value,Z(w));if(k(t))return _(t.error,r);const i=o.value,u=b(i,w);return k(u)?_(u.error,r):u.value}function Z(e){return{parent:void 0,symbols:new Set(Array.from(e.symbols.keys()))}}function K(){const e=document.getElementById("input"),n=document.getElementById("output");n&&new MutationObserver(()=>{n.scrollTop=n.scrollHeight}).observe(n,{childList:!0});const r=e.value,o=D(r);n.textContent+=`> ${r}
${o}
`}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("output");e&&(e.textContent=`



















Welcome! Try typing:

(+ 1 2)

and press Enter. For more info run:

(help)

`);const n=document.getElementById("input");n==null||n.focus(),n==null||n.setSelectionRange(n.value.length,n.value.length),n==null||n.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),K())})});
