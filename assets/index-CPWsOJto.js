(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const _={BOOLEAN:/^(true|false)/,NUMBER:/^[-+]?(?:\d*\.\d+|\d+\.\d*|\d+)/,STRING:/^"(\\.|[^"\\])*"|'(\\.|[^'\\])*'/,IDENTIFIER:/^(?:([_a-zA-Z][_a-zA-Z0-9]*)|([.,:;!?<>\=\@\#\$\+\-\*\/\%\&\|\^\~]+))/,LAMBDA:/^lambda/,LET:/^let/,ASSIGN:/^=/,IN:/^in/,IF:/^if/,THEN:/^then/,ELSE:/^else/,WHITESPACE:/^\s+/,OPEN:/^\(/,CLOSE:/^\)/};function C(e){let n={tag:"State",offset:0,line:e,tokens:[]};for(;n.offset<n.line.length;){const t=c(n,"BOOLEAN")??c(n,"NUMBER")??c(n,"STRING")??g(n,"LAMBDA")??g(n,"LET")??g(n,"ASSIGN")??g(n,"IN")??g(n,"IF")??g(n,"THEN")??g(n,"ELSE")??c(n,"IDENTIFIER")??c(n,"WHITESPACE")??c(n,"OPEN")??c(n,"CLOSE");if(t)t.lexeme==="BOOLEAN"?n=u(n,F(n,t)):t.lexeme==="NUMBER"?n=u(n,R(n,t)):t.lexeme==="STRING"?n=u(n,M(n,t)):t.lexeme==="LAMBDA"?n=u(n,D(n)):t.lexeme==="LET"?n=u(n,G(n)):t.lexeme==="ASSIGN"?n=u(n,U(n)):t.lexeme==="IN"?n=u(n,W(n)):t.lexeme==="IF"?n=u(n,z(n)):t.lexeme==="THEN"?n=u(n,Z(n)):t.lexeme==="ELSE"?n=u(n,q(n)):t.lexeme==="IDENTIFIER"?n=u(n,H(n,t)):t.lexeme==="OPEN"?n=u(n,K(n)):t.lexeme==="CLOSE"?n=u(n,j(n)):t.lexeme==="WHITESPACE"&&(n=u(n,J(n,t))),n.offset+=t.word.length;else throw Error(`Could not lex '${n.line[n.offset]}'.`)}return n=u(n,Q(n)),n.tokens}function c(e,n){const t=e.line.slice(e.offset),i=_[n].exec(t);if(i)return{lexeme:n,word:i[0]}}function g(e,n){const t=e.line.slice(e.offset),i=_[n].exec(t);if(i){t.slice(i[0].length);const o={offset:e.offset+i[0].length,line:e.line,tokens:e.tokens};return c(o,"OPEN")??c(o,"CLOSE")??c(o,"WHITESPACE")?{lexeme:n,word:i[0]}:void 0}else return}function u(e,n){return e.tokens.push(n),e}function F(e,n){const t=n.word!=="false";return{tag:"Token",lexeme:"BOOLEAN",id:e.tokens.length,offset:e.offset,value:t}}function R(e,n){return{tag:"Token",lexeme:"NUMBER",id:e.tokens.length,offset:e.offset,value:Number(n.word)}}function M(e,n){return{tag:"Token",lexeme:"STRING",id:e.tokens.length,offset:e.offset,value:n.word}}function H(e,n){return{tag:"Token",lexeme:"IDENTIFIER",id:e.tokens.length,offset:e.offset,value:n.word}}function D(e,n){return{tag:"Token",lexeme:"LAMBDA",id:e.tokens.length,offset:e.offset,value:"lambda"}}function G(e,n){return{tag:"Token",lexeme:"LET",id:e.tokens.length,offset:e.offset,value:"let"}}function U(e,n){return{tag:"Token",lexeme:"ASSIGN",id:e.tokens.length,offset:e.offset,value:"="}}function W(e,n){return{tag:"Token",lexeme:"IN",id:e.tokens.length,offset:e.offset,value:"in"}}function z(e,n){return{tag:"Token",lexeme:"IF",id:e.tokens.length,offset:e.offset,value:"if"}}function Z(e,n){return{tag:"Token",lexeme:"THEN",id:e.tokens.length,offset:e.offset,value:"then"}}function q(e,n){return{tag:"Token",lexeme:"ELSE",id:e.tokens.length,offset:e.offset,value:"else"}}function K(e,n){return{tag:"Token",lexeme:"OPEN",id:e.tokens.length,offset:e.offset,value:"("}}function j(e,n){return{tag:"Token",lexeme:"CLOSE",id:e.tokens.length,offset:e.offset,value:")"}}function J(e,n){return{tag:"Token",lexeme:"WHITESPACE",id:e.tokens.length,offset:e.offset,value:n.word}}function Q(e){return{tag:"Token",lexeme:"EOF",id:e.tokens.length,offset:e.offset,value:"EOF"}}function a(e){return e.tag==="Token"}function V(e){return a(e)&&e.lexeme==="BOOLEAN"}function X(e){return a(e)&&e.lexeme==="NUMBER"}function Y(e){return a(e)&&e.lexeme==="STRING"}function m(e){return a(e)&&e.lexeme==="IDENTIFIER"}function ee(e){return a(e)&&e.lexeme==="LAMBDA"}function ne(e){return a(e)&&e.lexeme==="LET"}function te(e){return a(e)&&e.lexeme==="IF"}function p(e){return a(e)&&e.lexeme==="OPEN"}function h(e){return a(e)&&e.lexeme==="CLOSE"}function v(e){return a(e)&&e.lexeme==="WHITESPACE"}function y(e){return a(e)&&e.lexeme==="EOF"}function ie(e){let n=[],t=0;for(let i=0;i<e.length;i++){const o=e[i];if(p(o))n.push(le(t,o.offset)),t++,n.push(k(t,o.offset)),t++;else if(h(o))n.push(k(t,o.offset)),t++,n.push(ue(t,o.offset)),t++;else{let r=o;r.id=t,t++,n.push(r)}}return n}function oe(e){let n=!1;for(let t=0;t<e.length;t++){const i=e[t];if(n)if(v(i)||y(i))n=!1;else throw Error(`Expected whitespace between tokens '${e[t-1].value}' and '${e[t].value}'.`);else v(i)||(n=!0)}return!0}function re(e){let n=[],t=0;for(let i=0;i<e.length;i++){const o=e[i];if(!v(o)){let r=o;r.id=t,n.push(r),t++}}return n}function k(e,n){return{tag:"Token",lexeme:"WHITESPACE",id:e,offset:n,value:" "}}function le(e,n){return{tag:"Token",lexeme:"OPEN",id:e,offset:n,value:"("}}function ue(e,n){return{tag:"Token",lexeme:"CLOSE",id:e,offset:n,value:")"}}function se(e){return e.tag==="Nested_Boolean"}function ae(e){return e.tag==="Nested_Number"}function ce(e){return e.tag==="Nested_String"}function de(e){return e.tag==="Nested_Identifier"}function fe(e){return e.tag==="Nested_Binding"}function ge(e){return e.tag==="Nested_Lambda"}function me(e){return e.tag==="Nested_Let"}function he(e){return e.tag==="Nested_If"}function ve(e){return e.tag==="Nested_Call"}class be{constructor(n){this.index=0,this.node_count=0,this.tokens=re(n)}peek(){if(0<=this.index&&this.index<this.tokens.length)return this.tokens[this.index];throw Error("Parser::peek() is out-of-bounds")}previous(){if(1<=this.index&&this.index<this.tokens.length+1)return this.tokens[this.index-1];throw Error("Parser::previous() is out-of-bounds")}consume(){this.index++}emit(){const n=this.node_count;return this.node_count++,n}is_at_end(){return y(this.peek())}expr(){if(this.is_at_end())throw Error("Parser::expr() is out-of-bounds");if(V(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Boolean",value:this.previous().value};if(X(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Number",value:this.previous().value};if(Y(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_String",value:this.previous().value};if(m(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Identifier",name:this.previous().value};if(p(this.peek())){this.consume();const n=this.peek();return ee(n)?this.lambda():ne(n)?this.letbind():te(n)?this.iff():this.call()}else throw h(this.peek())?Error("Expected an expression but got ')' instead"):Error(`Unknown token tag '${this.peek()}'`)}lambda(){const n=this.emit(),t=this.peek();if(this.consume(),m(this.peek())){const i=this.binding(),o=this.expr();return this.expect_closing(),{id:n,token:t.id-1,tag:"Nested_Lambda",binding:i,body:o}}else throw new Error(`Expected an 'lambda' to be followed by an identifier but got a ${this.peek().lexeme} instead`)}letbind(){const n=this.emit(),t=this.peek();if(this.consume(),m(this.peek())){const i=this.binding(),o=this.expr(),r=this.expr();return this.expect_closing(),{id:n,token:t.id-1,tag:"Nested_Let",binding:i,value:o,body:r}}else throw new Error(`Expected an 'let' to be followed by an identifier but got a ${this.peek().lexeme} instead`)}iff(){const n=this.emit(),t=this.peek();this.consume();const i=this.expr(),o=this.expr(),r=this.expr();return this.expect_closing(),{id:n,token:t.id-1,tag:"Nested_If",condition:i,then_branch:o,else_branch:r}}call(){const n=this.emit(),t=this.expr(),i=this.expr();return this.expect_closing(),{id:n,token:t.token-1,tag:"Nested_Call",fn:t,arg:i}}binding(){const n=this.emit(),t=this.peek();return this.consume(),{id:n,token:t.id,tag:"Nested_Binding",name:t.value}}expect_closing(){if(this.is_at_end())throw Error("Expected ')' but went out-of-bounds");if(h(this.peek()))this.consume();else throw new Error(`Expected ')' but got '${this.peek().value}' of type '${this.peek().lexeme}' instead`)}}function ke(e){let n=new be(e);const t=n.expr();if(n.is_at_end())return{ast:t,node_count:n.node_count};throw Error("Expected a single expression, failed to fully parse input")}const w=["==","!=","<",">","<=",">=","+","-","*","/","%","~","&&","||","!"];function N(e,n){return e.tag==="Flat_Literal"}function I(e,n){return e.tag==="Flat_Identifier"}function x(e,n){return e.tag==="Flat_Binding"}function T(e,n){return e.tag==="Flat_Reference"}function L(e,n){return e.tag==="Flat_Lambda"}function B(e,n){return e.tag==="Flat_Let"}function S(e,n){return e.tag==="Flat_If"}function P(e,n){return e.tag==="Flat_Call"}function Ee(e,n){return e.tag==="Flat_Builtin"}function _e(){return{parent:void 0,bindings:new Map}}function $(e){return{parent:e,bindings:new Map}}function O(e,n){const t=n.bindings.get(e);if(t!==void 0)return t;if(n.parent!==void 0)return O(e,n.parent);throw new Error(`variable with id ${e} is undefined`)}function f(e,n,t){if(N(e))return{tag:"Primitive",value:e.value};if(I(e))throw Error(`Cannot evaluate unresolved reference to '${e.name}' at token ${e.token}`);if(x(e))return O(e.id,t);if(T(e))return f(n[e.target.id],n,t);if(Ee(e))return Ne(e);if(L(e))return{tag:"Closure",binding:e.binding,body:e.body,env:t};if(B(e)){let i=$(t);return i.bindings.set(e.binding.id,f(n[e.value.id],n,t)),f(n[e.body.id],n,i)}else if(S(e)){const i=f(n[e.condition.id],n,t);if(b(i)&&typeof i.value=="boolean")return f(n[i.value?e.then_branch.id:e.else_branch.id],n,t);throw new Error(`Expect condition in 'if' expression to evaluate to a boolean value, evaluated to ${i.tag} instead`)}else if(P(e)){const i=f(n[e.body.id],n,t),o=f(n[e.arg.id],n,t);return pe(i,o,n)}else throw new Error("unhandled case in evaluation control flow")}function pe(e,n,t){if(ye(e)){let i=$(e.env);return i.bindings.set(e.binding.id,n),f(t[e.body.id],t,i)}else if(we(e)){if(b(n))return e.args.push(n),e.args.length==e.arity?e.impl(e.args):e;throw Error(`Tried calling builtin function '${e.name}' with non-primitive argument of type '${n.tag}'`)}else throw`Expected a function, but got '${e.value}' of type '${e.tag}'`}function b(e){return e.tag==="Primitive"}function ye(e){return e.tag==="Closure"}function we(e){return e.tag==="Builtin"}function Ne(e,n){switch(e.name){case"~":return{tag:"Builtin",name:e.name,arity:1,impl:t=>({tag:"Primitive",value:-t[0].value}),args:[]};case"!":return{tag:"Builtin",name:e.name,arity:1,impl:t=>({tag:"Primitive",value:!t[0].value}),args:[]};case"==":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value==t[1].value}),args:[]};case"!=":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value!=t[1].value}),args:[]};case"<":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value<t[1].value}),args:[]};case">":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value>t[1].value}),args:[]};case"<=":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value<=t[1].value}),args:[]};case">=":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value>=t[1].value}),args:[]};case"+":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value+t[1].value}),args:[]};case"-":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value-t[1].value}),args:[]};case"*":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value*t[1].value}),args:[]};case"/":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value/t[1].value}),args:[]};case"%":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value%t[1].value}),args:[]};case"&&":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value&&t[1].value}),args:[]};case"||":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value||t[1].value}),args:[]}}}function Ie(e,n){const t=Array(n);return s(e,t)}function s(e,n){if(ge(e)){const t=e.id,i={id:e.binding.id},o={id:e.body.id};let r={id:t,token:e.token,tag:"Flat_Lambda",binding:i,body:o};n[t]=r,n=s(e.binding,n),n=s(e.body,n)}else if(me(e)){const t=e.id,i={id:e.binding.id},o={id:e.value.id},r={id:e.body.id};let l={id:t,token:e.token,tag:"Flat_Let",binding:i,value:o,body:r};n[t]=l,n=s(e.binding,n),n=s(e.value,n),n=s(e.body,n)}else if(he(e)){const t=e.id,i={id:e.condition.id},o={id:e.then_branch.id},r={id:e.else_branch.id};let l={id:t,token:e.token,tag:"Flat_If",condition:i,then_branch:o,else_branch:r};n[t]=l,n=s(e.condition,n),n=s(e.then_branch,n),n=s(e.else_branch,n)}else if(ve(e)){const t=e.id,i={id:e.fn.id},o={id:e.arg.id};let r={id:t,token:e.token,tag:"Flat_Call",body:i,arg:o};n[t]=r,n=s(e.fn,n),n=s(e.arg,n)}else if(se(e)||ae(e)||ce(e)){const t=e.id;let i={id:t,token:e.token,tag:"Flat_Literal",value:e.value};n[t]=i}else if(de(e)){const t=e.id;let i={id:t,token:e.token,tag:"Flat_Identifier",name:e.name};n[t]=i}else if(fe(e)){const t=e.id;let i={id:t,token:e.token,tag:"Flat_Binding",name:e.name};n[t]=i}else throw Error(`Cannot convert nested node of tag '${e.tag}' to a corresponding tag of flat node.`);return n}function xe(e){let n=e.map(i=>i),t=Be();return d(n[0],n,t)}function d(e,n,t){if(N(e)||x(e)||T(e))return n;if(I(e)){const i=e.id,o=e.token,r=A(e.name,t);if(r==="builtin")if(w.includes(e.name)){const l={id:i,token:o,tag:"Flat_Builtin",name:e.name};n[i]=l}else throw new Error(`'${e.name}' is not a built-in function`);else{const l={id:i,token:o,tag:"Flat_Reference",target:{id:r}};n[i]=l}return n}else if(L(e)){const i=n[e.binding.id],o=n[e.body.id];let r=E(t);return r.bindings.set(i.name,i.id),n=d(o,n,r),n}else if(B(e)){const i=n[e.binding.id],o=n[e.value.id],r=n[e.body.id];let l=E(t);return l.bindings.set(i.name,i.id),n=d(o,n,t),n=d(r,n,l),n}else if(P(e)){const i=n[e.body.id],o=n[e.arg.id];return n=d(i,n,t),n=d(o,n,t),n}else if(S(e)){const i=n[e.condition.id],o=n[e.then_branch.id],r=n[e.else_branch.id];return n=d(i,n,t),n=d(o,n,t),n=d(r,n,t),n}else throw Error(`Name resolution not implemented for node ${e.id} of tag ${e.tag}`)}function A(e,n){if(Te(n)){const t=n.bindings.get(e);if(t!==void 0)return t;throw new Error(`variable with name ${e} is undefined`)}else if(Le(n)){const t=n.bindings.get(e);return t!==void 0?t:A(e,n.parent)}else throw Error("Invalid tag of scope. Something is wrong with the name resolution implementation.")}function Te(e){return e.tag==="GlobalScope"}function Le(e){return e.tag==="Scope"}function E(e){return{tag:"Scope",parent:e,bindings:new Map}}function Be(){let e=new Map;for(let n of w)e.set(n,"builtin");return{tag:"GlobalScope",bindings:e}}function Se(e){let n=0;for(let t=0;t<e.length;t++)if(e[t]=="("?n++:e[t]==")"&&n--,n<0)throw Error(`Unbalanced parentheses. Expected '(' before character ${t}.`);if(n!=0)throw Error(`Unbalanced parentheses. Expected ${n} more ')'.`);return!0}function Pe(e){Se(e);const n=C(e);oe(ie(n));const t=ke(n),i=Ie(t.ast,t.node_count),o=xe(i);let r=_e();const l=f(o[0],o,r);if(b(l))return l.value;throw Error(`Expected final result to be a boolean, number, or string, got a '${l.tag}' instead`)}function $e(){const e=document.getElementById("input"),n=document.getElementById("output");n&&new MutationObserver(()=>{n.scrollTop=n.scrollHeight}).observe(n,{childList:!0});const t=e.value;try{const i=Pe(t);n.textContent+=`> ${t}
${i}
`}catch(i){const o=i instanceof Error?i.message:String(i);n.textContent+=`> ${t}
${o}
`}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("help-btn"),n=document.getElementById("help-box");e==null||e.addEventListener("click",()=>{n&&e&&(n.style.display==="block"?(n.style.display="none",e.textContent="Help"):(n.style.display="block",e.textContent="Close Help"))});const t=document.getElementById("output");t&&(t.textContent=`



















Welcome! Try typing:

((+ 1) 2)

and press Enter.

For more info, click on the 'Help'
button in the top-left corner.

`);const i=document.getElementById("input");i==null||i.focus(),i==null||i.setSelectionRange(i.value.length,i.value.length),i==null||i.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),$e())})});
