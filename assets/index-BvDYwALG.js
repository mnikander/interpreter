(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const C={WHITESPACE:/^\s+/,OPEN:/^\(/,CLOSE:/^\)/,BOOLEAN:/^(true|false)/,NUMBER:/^[-+]?(?:\d*\.\d+|\d+\.\d*|\d+)/,STRING:/^"(\\.|[^"\\])*"|'(\\.|[^'\\])*'/,IDENTIFIER:/^(?:([_a-zA-Z][_a-zA-Z0-9]*)|([.,:;!?<>\=\@\#\$\+\-\*\/\%\&\|\^\~]+))/,LAMBDA:/^lambda/,LET:/^let/,IF:/^if/};function F(e){let n={tag:"State",offset:0,line:e,tokens:[]};for(;n.offset<n.line.length;){const t=c(n,"BOOLEAN")??c(n,"NUMBER")??c(n,"STRING")??c(n,"LAMBDA")??c(n,"LET")??c(n,"IF")??c(n,"IDENTIFIER")??c(n,"WHITESPACE")??c(n,"OPEN")??c(n,"CLOSE");if(t)t.lexeme==="BOOLEAN"?n=u(n,S(n,t)):t.lexeme==="NUMBER"?n=u(n,A(n,t)):t.lexeme==="STRING"?n=u(n,R(n,t)):t.lexeme==="LAMBDA"?n=u(n,D(n)):t.lexeme==="LET"?n=u(n,H(n)):t.lexeme==="IF"?n=u(n,U(n)):t.lexeme==="IDENTIFIER"?n=u(n,M(n,t)):t.lexeme==="OPEN"?n=u(n,G(n)):t.lexeme==="CLOSE"?n=u(n,W(n)):t.lexeme==="WHITESPACE"&&(n=u(n,z(n,t))),n.offset+=t.word.length;else throw Error(`Could not lex '${n.line[n.offset]}'.`)}return n=u(n,Z(n)),n.tokens}function c(e,n){const t=e.line.slice(e.offset),i=C[n].exec(t);if(i)return{lexeme:n,word:i[0]}}function u(e,n){return e.tokens.push(n),e}function S(e,n){const t=n.word!=="false";return{tag:"Token",lexeme:"BOOLEAN",id:e.tokens.length,offset:e.offset,value:t}}function A(e,n){return{tag:"Token",lexeme:"NUMBER",id:e.tokens.length,offset:e.offset,value:Number(n.word)}}function R(e,n){return{tag:"Token",lexeme:"STRING",id:e.tokens.length,offset:e.offset,value:n.word}}function M(e,n){return{tag:"Token",lexeme:"IDENTIFIER",id:e.tokens.length,offset:e.offset,value:n.word}}function D(e,n){return{tag:"Token",lexeme:"LAMBDA",id:e.tokens.length,offset:e.offset,value:"lambda"}}function H(e,n){return{tag:"Token",lexeme:"LET",id:e.tokens.length,offset:e.offset,value:"let"}}function U(e,n){return{tag:"Token",lexeme:"IF",id:e.tokens.length,offset:e.offset,value:"if"}}function G(e,n){return{tag:"Token",lexeme:"OPEN",id:e.tokens.length,offset:e.offset,value:"("}}function W(e,n){return{tag:"Token",lexeme:"CLOSE",id:e.tokens.length,offset:e.offset,value:")"}}function z(e,n){return{tag:"Token",lexeme:"WHITESPACE",id:e.tokens.length,offset:e.offset,value:n.word}}function Z(e){return{tag:"Token",lexeme:"EOF",id:e.tokens.length,offset:e.offset,value:"EOF"}}function a(e){return e.tag==="Token"}function q(e){return a(e)&&e.lexeme==="BOOLEAN"}function K(e){return a(e)&&e.lexeme==="NUMBER"}function j(e){return a(e)&&e.lexeme==="STRING"}function g(e){return a(e)&&e.lexeme==="IDENTIFIER"}function J(e){return a(e)&&e.lexeme==="LAMBDA"}function Q(e){return a(e)&&e.lexeme==="LET"}function V(e){return a(e)&&e.lexeme==="IF"}function _(e){return a(e)&&e.lexeme==="OPEN"}function m(e){return a(e)&&e.lexeme==="CLOSE"}function h(e){return a(e)&&e.lexeme==="WHITESPACE"}function E(e){return a(e)&&e.lexeme==="EOF"}function X(e){let n=[],t=0;for(let i=0;i<e.length;i++){const o=e[i];if(_(o))n.push(ne(t,o.offset)),t++,n.push(v(t,o.offset)),t++;else if(m(o))n.push(v(t,o.offset)),t++,n.push(te(t,o.offset)),t++;else{let r=o;r.id=t,t++,n.push(r)}}return n}function Y(e){let n=!1;for(let t=0;t<e.length;t++){const i=e[t];if(n)if(h(i)||E(i))n=!1;else throw Error(`Expected whitespace between tokens '${e[t-1].value}' and '${e[t].value}'.`);else h(i)||(n=!0)}return!0}function ee(e){let n=[],t=0;for(let i=0;i<e.length;i++){const o=e[i];if(!h(o)){let r=o;r.id=t,n.push(r),t++}}return n}function v(e,n){return{tag:"Token",lexeme:"WHITESPACE",id:e,offset:n,value:" "}}function ne(e,n){return{tag:"Token",lexeme:"OPEN",id:e,offset:n,value:"("}}function te(e,n){return{tag:"Token",lexeme:"CLOSE",id:e,offset:n,value:")"}}function ie(e){return e.tag==="Nested_Boolean"}function oe(e){return e.tag==="Nested_Number"}function re(e){return e.tag==="Nested_String"}function le(e){return e.tag==="Nested_Identifier"}function ue(e){return e.tag==="Nested_Binding"}function se(e){return e.tag==="Nested_Lambda"}function ae(e){return e.tag==="Nested_Let"}function ce(e){return e.tag==="Nested_If"}function de(e){return e.tag==="Nested_Call"}class fe{constructor(n){this.index=0,this.node_count=0,this.tokens=ee(n)}peek(){if(0<=this.index&&this.index<this.tokens.length)return this.tokens[this.index];throw Error("Parser::peek() is out-of-bounds")}previous(){if(1<=this.index&&this.index<this.tokens.length+1)return this.tokens[this.index-1];throw Error("Parser::previous() is out-of-bounds")}consume(){this.index++}emit(){const n=this.node_count;return this.node_count++,n}is_at_end(){return E(this.peek())}expr(){if(this.is_at_end())throw Error("Parser::expr() is out-of-bounds");if(q(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Boolean",value:this.previous().value};if(K(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Number",value:this.previous().value};if(j(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_String",value:this.previous().value};if(g(this.peek()))return this.consume(),{id:this.emit(),token:this.index-1,tag:"Nested_Identifier",name:this.previous().value};if(_(this.peek())){this.consume();const n=this.peek();return J(n)?this.lambda():Q(n)?this.letbind():V(n)?this.iff():this.call()}else throw m(this.peek())?Error("Expected an expression but got ')' instead"):Error(`Unknown token tag '${this.peek()}'`)}lambda(){const n=this.emit(),t=this.peek();if(this.consume(),g(this.peek())){const i=this.binding(),o=this.expr();return this.expect_closing(),{id:n,token:t.id-1,tag:"Nested_Lambda",binding:i,body:o}}else throw new Error(`Expected an 'lambda' to be followed by an identifier but got a ${this.peek().lexeme} instead`)}letbind(){const n=this.emit(),t=this.peek();if(this.consume(),g(this.peek())){const i=this.binding(),o=this.expr(),r=this.expr();return this.expect_closing(),{id:n,token:t.id-1,tag:"Nested_Let",binding:i,value:o,body:r}}else throw new Error(`Expected an 'let' to be followed by an identifier but got a ${this.peek().lexeme} instead`)}iff(){const n=this.emit(),t=this.peek();this.consume();const i=this.expr(),o=this.expr(),r=this.expr();return this.expect_closing(),{id:n,token:t.id-1,tag:"Nested_If",condition:i,then_branch:o,else_branch:r}}call(){const n=this.emit(),t=this.expr(),i=this.expr();return this.expect_closing(),{id:n,token:t.token-1,tag:"Nested_Call",fn:t,arg:i}}binding(){const n=this.emit(),t=this.peek();return this.consume(),{id:n,token:t.id,tag:"Nested_Binding",name:t.value}}expect_closing(){if(this.is_at_end())throw Error("Expected ')' but went out-of-bounds");if(m(this.peek()))this.consume();else throw new Error(`Expected ')' but got a '${this.peek().lexeme}' instead`)}}function ge(e){let n=new fe(e);const t=n.expr();if(n.is_at_end())return{ast:t,node_count:n.node_count};throw Error("Expected a single expression, failed to fully parse input")}const p=["==","!=","<",">","<=",">=","+","-","*","/","%","~","&&","||","!"];function y(e,n){return e.tag==="Flat_Literal"}function w(e,n){return e.tag==="Flat_Identifier"}function N(e,n){return e.tag==="Flat_Binding"}function I(e,n){return e.tag==="Flat_Reference"}function B(e,n){return e.tag==="Flat_Lambda"}function x(e,n){return e.tag==="Flat_Let"}function L(e,n){return e.tag==="Flat_If"}function T(e,n){return e.tag==="Flat_Call"}function me(e,n){return e.tag==="Flat_Builtin"}function he(){return{parent:void 0,bindings:new Map}}function $(e){return{parent:e,bindings:new Map}}function P(e,n){const t=n.bindings.get(e);if(t!==void 0)return t;if(n.parent!==void 0)return P(e,n.parent);throw new Error(`variable with id ${e} is undefined`)}function f(e,n,t){if(y(e))return{tag:"Primitive",value:e.value};if(w(e))throw Error(`Cannot evaluate unresolved reference to '${e.name}' at token ${e.token}`);if(N(e))return P(e.id,t);if(I(e))return f(n[e.target.id],n,t);if(me(e))return _e(e);if(B(e))return{tag:"Closure",binding:e.binding,body:e.body,env:t};if(x(e)){let i=$(t);return i.bindings.set(e.binding.id,f(n[e.value.id],n,t)),f(n[e.body.id],n,i)}else if(L(e)){const i=f(n[e.condition.id],n,t);if(b(i)&&typeof i.value=="boolean")return f(n[i.value?e.then_branch.id:e.else_branch.id],n,t);throw new Error(`Expect condition in 'if' expression to evaluate to a boolean value, evaluated to ${i.tag} instead`)}else if(T(e)){const i=f(n[e.body.id],n,t),o=f(n[e.arg.id],n,t);return be(i,o,n)}else throw new Error("unhandled case in evaluation control flow")}function be(e,n,t){if(ve(e)){let i=$(e.env);return i.bindings.set(e.binding.id,n),f(t[e.body.id],t,i)}else if(ke(e)){if(b(n))return e.args.push(n),e.args.length==e.arity?e.impl(e.args):e;throw Error(`Tried calling builtin function '${e.name}' with non-primitive argument of type '${n.tag}'`)}else throw`Expected a function, but got '${e.value}' of type '${e.tag}'`}function b(e){return e.tag==="Primitive"}function ve(e){return e.tag==="Closure"}function ke(e){return e.tag==="Builtin"}function _e(e,n){switch(e.name){case"~":return{tag:"Builtin",name:e.name,arity:1,impl:t=>({tag:"Primitive",value:-t[0].value}),args:[]};case"!":return{tag:"Builtin",name:e.name,arity:1,impl:t=>({tag:"Primitive",value:!t[0].value}),args:[]};case"==":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value==t[1].value}),args:[]};case"!=":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value!=t[1].value}),args:[]};case"<":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value<t[1].value}),args:[]};case">":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value>t[1].value}),args:[]};case"<=":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value<=t[1].value}),args:[]};case">=":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value>=t[1].value}),args:[]};case"+":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value+t[1].value}),args:[]};case"-":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value-t[1].value}),args:[]};case"*":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value*t[1].value}),args:[]};case"/":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value/t[1].value}),args:[]};case"%":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value%t[1].value}),args:[]};case"&&":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value&&t[1].value}),args:[]};case"||":return{tag:"Builtin",name:e.name,arity:2,impl:t=>({tag:"Primitive",value:t[0].value||t[1].value}),args:[]}}}function Ee(e,n){const t=Array(n);return s(e,t)}function s(e,n){if(se(e)){const t=e.id,i={id:e.binding.id},o={id:e.body.id};let r={id:t,token:e.token,tag:"Flat_Lambda",binding:i,body:o};n[t]=r,n=s(e.binding,n),n=s(e.body,n)}else if(ae(e)){const t=e.id,i={id:e.binding.id},o={id:e.value.id},r={id:e.body.id};let l={id:t,token:e.token,tag:"Flat_Let",binding:i,value:o,body:r};n[t]=l,n=s(e.binding,n),n=s(e.value,n),n=s(e.body,n)}else if(ce(e)){const t=e.id,i={id:e.condition.id},o={id:e.then_branch.id},r={id:e.else_branch.id};let l={id:t,token:e.token,tag:"Flat_If",condition:i,then_branch:o,else_branch:r};n[t]=l,n=s(e.condition,n),n=s(e.then_branch,n),n=s(e.else_branch,n)}else if(de(e)){const t=e.id,i={id:e.fn.id},o={id:e.arg.id};let r={id:t,token:e.token,tag:"Flat_Call",body:i,arg:o};n[t]=r,n=s(e.fn,n),n=s(e.arg,n)}else if(ie(e)||oe(e)||re(e)){const t=e.id;let i={id:t,token:e.token,tag:"Flat_Literal",value:e.value};n[t]=i}else if(le(e)){const t=e.id;let i={id:t,token:e.token,tag:"Flat_Identifier",name:e.name};n[t]=i}else if(ue(e)){const t=e.id;let i={id:t,token:e.token,tag:"Flat_Binding",name:e.name};n[t]=i}else throw Error(`Cannot convert nested node of tag '${e.tag}' to a corresponding tag of flat node.`);return n}function pe(e){let n=e.map(i=>i),t=Ne();return d(n[0],n,t)}function d(e,n,t){if(y(e)||N(e)||I(e))return n;if(w(e)){const i=e.id,o=e.token,r=O(e.name,t);if(r==="builtin")if(p.includes(e.name)){const l={id:i,token:o,tag:"Flat_Builtin",name:e.name};n[i]=l}else throw new Error(`'${e.name}' is not a built-in function`);else{const l={id:i,token:o,tag:"Flat_Reference",target:{id:r}};n[i]=l}return n}else if(B(e)){const i=n[e.binding.id],o=n[e.body.id];let r=k(t);return r.bindings.set(i.name,i.id),n=d(o,n,r),n}else if(x(e)){const i=n[e.binding.id],o=n[e.value.id],r=n[e.body.id];let l=k(t);return l.bindings.set(i.name,i.id),n=d(o,n,t),n=d(r,n,l),n}else if(T(e)){const i=n[e.body.id],o=n[e.arg.id];return n=d(i,n,t),n=d(o,n,t),n}else if(L(e)){const i=n[e.condition.id],o=n[e.then_branch.id],r=n[e.else_branch.id];return n=d(i,n,t),n=d(o,n,t),n=d(r,n,t),n}else throw Error(`Name resolution not implemented for node ${e.id} of tag ${e.tag}`)}function O(e,n){if(ye(n)){const t=n.bindings.get(e);if(t!==void 0)return t;throw new Error(`variable with name ${e} is undefined`)}else if(we(n)){const t=n.bindings.get(e);return t!==void 0?t:O(e,n.parent)}else throw Error("Invalid tag of scope. Something is wrong with the name resolution implementation.")}function ye(e){return e.tag==="GlobalScope"}function we(e){return e.tag==="Scope"}function k(e){return{tag:"Scope",parent:e,bindings:new Map}}function Ne(){let e=new Map;for(let n of p)e.set(n,"builtin");return{tag:"GlobalScope",bindings:e}}function Ie(e){let n=0;for(let t=0;t<e.length;t++)if(e[t]=="("?n++:e[t]==")"&&n--,n<0)throw Error(`Unbalanced parentheses. Expected '(' before character ${t}.`);if(n!=0)throw Error(`Unbalanced parentheses. Expected ${n} more ')'.`);return!0}function Be(e){Ie(e);const n=F(e);Y(X(n));const t=ge(n),i=Ee(t.ast,t.node_count),o=pe(i);let r=he();const l=f(o[0],o,r);if(b(l))return l.value;throw Error(`Expected final result to be a boolean, number, or string, got a '${l.tag}' instead`)}function xe(){const e=document.getElementById("input"),n=document.getElementById("output");n&&new MutationObserver(()=>{n.scrollTop=n.scrollHeight}).observe(n,{childList:!0});const t=e.value;try{const i=Be(t);n.textContent+=`> ${t}
${i}
`}catch(i){const o=i instanceof Error?i.message:String(i);n.textContent+=`> ${t}
${o}
`}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("help-btn"),n=document.getElementById("help-box");e==null||e.addEventListener("click",()=>{n&&e&&(n.style.display==="block"?(n.style.display="none",e.textContent="Help"):(n.style.display="block",e.textContent="Close Help"))});const t=document.getElementById("output");t&&(t.textContent=`



















Welcome! Try typing:

((+ 1) 2)

and press Enter.

For more info, click on the 'Help'
button in the top-left corner.

`);const i=document.getElementById("input");i==null||i.focus(),i==null||i.setSelectionRange(i.value.length,i.value.length),i==null||i.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),xe())})});
